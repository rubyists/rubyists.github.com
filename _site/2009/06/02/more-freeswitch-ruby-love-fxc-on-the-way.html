<p>With <a href='http://code.rubyists.com/projects/fs'>FSR</a> well under way and being used both internally and in the wild for FreeSWITCH application development, the next logical step will be a Configurator for FreeSWITCH itself. FreeSWITCH has long lacked the standard Administrator/User configuration available via web or GUI, FXC is intended to allow web interfaces for configuration to be built easily with any Rack application utilizing the FreeSWITCH xml_curl interface. The first pass of FXC will include some Rack middleware which turns FreeSWITCH requests (to /) into easy to organize routes such as /directory/register/internal/1000, /dialplan/public/8885551212, /configuration/acl.conf. The goal is to eliminate the gruntwork of routing by POST variables, exposing clean Rack-app routes up the stack (for ramaze, sinatra, etc). The following is an example with ramaze.</p>
<strong><em>middleware.rb</em></strong><pre class='markdown-html-error' style='border: solid 3px red; background-color: pink'>REXML could not parse this XML/HTML: 
&lt;typo:code lang=&quot;ruby&quot;&gt;
module FXC
  module Rack
    class Middleware
      def initialize(app)
        @app = app
      end

      def call(env)
        r = ::Rack::Request.new(env)
        return @app.call(env) unless r.params[&quot;section&quot;]
        path = r.params[&quot;section&quot;] + &quot;/&quot;
        path &lt;&lt; case path
        when &quot;dialplan/&quot;
          dp_req(env, r)
        when &quot;directory/&quot;
          dir_req(env, r)
        when &quot;configuration/&quot;
          conf_req(env, r)
        end
        env[&quot;PATH_INFO&quot;] &lt;&lt; (env[&quot;PATH_INFO&quot;].match(%r{/$}) ? path : &quot;/#{path}&quot;)
        @app.call(env)
      end

      private
      def dp_req(env, r)
        s = [r.params[&quot;Caller-Context&quot;]]
        s &lt;&lt; r.params[&quot;Caller-Destination-Number&quot;]
        s.join(&quot;/&quot;)
      end

      def dir_req(env, r)
        s = []
        if r.params[&quot;purpose&quot;]
          s &lt;&lt; r.params[&quot;purpose&quot;].gsub(&quot;-&quot;,&quot;_&quot;)
          s &lt;&lt; r.params[&quot;sip_profile&quot;]
        elsif r.params[&quot;action&quot;] and r.params[&quot;action&quot;] == &quot;sip_auth&quot;
          s &lt;&lt; &quot;register&quot;
          s &lt;&lt; r.params[&quot;sip_profile&quot;]
          s &lt;&lt; r.params[&quot;sip_auth_username&quot;]
        elsif r.params[&quot;user&quot;]
          s &lt;&lt; &quot;voicemail&quot;
          s &lt;&lt; r.params[&quot;sip_profile&quot;]
          s &lt;&lt; r.params[&quot;user&quot;]
        end
        s.join(&quot;/&quot;)
      end

      def conf_req(env, r)
        s = []
        if r.params[&quot;key_name&quot;] == &quot;name&quot;
          s &lt;&lt; r.params[&quot;key_value&quot;]
        end
        s.join(&quot;/&quot;)
      end

    end
  end
end

&lt;/typo:code&gt;</pre><strong><em>controller/dialplan.rb</em></strong><pre class='markdown-html-error' style='border: solid 3px red; background-color: pink'>REXML could not parse this XML/HTML: 
&lt;typo:code lang=&quot;ruby&quot;&gt;
# Copyright (c) 2008-2009 The Rubyists, LLC (effortless systems) &lt;rubyists@rubyists.com&gt;
# Distributed under the terms of the MIT license.
# The full text can be found in the LICENSE file included with this software
#
module FXC
  class Dialplan &lt; Controller
    map &apos;/dialplan&apos;
    layout :dialplan

    def index(*args)
      Ramaze::Log.info(&quot;Got unhandled dialplan request: &quot; + request.inspect)
      not_found
    end

    def default(number)
      Ramaze::Log.info(&quot;got default dialplan request for #{number}&quot;)
      not_found
    end

    def public(number)
      @did = FXC::Did.first(:number.like /#{number.sub(/^1/,&apos;1?&apos;)}/)
      if @did 
        @user = @did.user
        @targets = @did.targets
        Ramaze::Log.info(&quot;Routing #{@did.number} to #{@user.dialstring}&quot;)
        render_view(:index)
      else
        Ramaze::Log.info(&quot;Got public dialplan request for #{number}, but no DID matches: &quot;)
        not_found
      end
    end
  end
end

&lt;/typo:code&gt;</pre>
<p>In the FXC::Dialplan controller, each method represents a FreeSWICH <a href='http://wiki.freeswitch.org/wiki/Dialplan_XML#Context'>dialplan context</a>. Undefined contexts (in this ramaze controller) will fallthrough to the index method and be logged.</p>

<p>Finally, the FreeSWITCH configuration to send requests to above app becomes a single line/single url</p>
<strong><em>conf/autoload_configs/xml_curl.conf.xml</em></strong><pre class='markdown-html-error' style='border: solid 3px red; background-color: pink'>REXML could not parse this XML/HTML: 
&lt;typo:code lang=&quot;xml&quot;&gt;

&lt;configuration name=&quot;xml_curl.conf&quot; description=&quot;cURL XML Gateway&quot;&gt;
  &lt;bindings&gt;
    &lt;binding name=&quot;fxc&quot;&gt;
      &lt;param name=&quot;gateway-url&quot; value=&quot;http://127.0.0.1:9292/&quot; bindings=&quot;configuration|directory|dialplan&quot;/&gt;
    &lt;/binding&gt;
  &lt;/bindings&gt;
&lt;/configuration&gt;

&lt;/typo:code&gt;</pre>
<p>Next step is completing all the methods available for each binding type (configuration, dialplan, directory). Once complete FreeSWITCH web config on Rack should follow rapidly. That will be the &#8220;Look Ma, No XML&#8221; FXC release (TBA).</p>